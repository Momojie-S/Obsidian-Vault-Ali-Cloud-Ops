# éƒ¨ç½²ç¯å¢ƒ

æœåŠ¡å™¨éƒ¨ç½²ç›¸å…³çš„æœåŠ¡é…ç½®å’Œç›®å½•ç»“æ„ã€‚

## æœåŠ¡å™¨åˆå§‹åŒ–ï¼ˆé‡ç½®åç¬¬ä¸€æ­¥ï¼‰

> âš ï¸ é‡è¦ï¼šHomebrew ç­‰å·¥å…·ä¸å…è®¸ä½¿ç”¨ root è¿è¡Œï¼Œå¿…é¡»å…ˆåˆ›å»ºæ™®é€šç”¨æˆ·ã€‚

### åˆ›å»ºé root ç”¨æˆ·

```bash
# 1. åˆ›å»ºç”¨æˆ·ï¼ˆæ— å¯†ç ï¼‰
/usr/sbin/useradd -m -s /bin/bash momojie

# 2. å¤åˆ¶ SSH è¯ä¹¦ï¼ˆä¸ root ç›¸åŒï¼‰
mkdir -p /home/momojie/.ssh
cp /root/.ssh/authorized_keys /home/momojie/.ssh/
chown -R momojie:momojie /home/momojie/.ssh
chmod 700 /home/momojie/.ssh
chmod 600 /home/momojie/.ssh/authorized_keys

# 3. æ·»åŠ  sudo æƒé™
/usr/sbin/usermod -aG sudo momojie
```

### éªŒè¯

```bash
# ç¡®è®¤ç”¨æˆ·åˆ›å»ºæˆåŠŸ
id momojie

# ç¡®è®¤ SSH é…ç½®æ­£ç¡®
ls -la /home/momojie/.ssh/
```

### SSH é…ç½®

ç¡®ä¿ `/etc/ssh/sshd_config` ä¸­ç¦ç”¨å¯†ç ç™»å½•ï¼š
```
PasswordAuthentication no
PubkeyAuthentication yes
```

### é…ç½® sudo å…å¯†ï¼ˆHomebrew å®‰è£…éœ€è¦ï¼‰

```bash
echo "momojie ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/momojie
chmod 440 /etc/sudoers.d/momojie
```

### å®‰è£… Homebrew

```bash
# ä»¥ momojie ç”¨æˆ·ç™»å½•ï¼Œä½¿ç”¨ä»£ç†å®‰è£…
su - momojie
export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå®‰è£…è„šæœ¬ä¼šæç¤ºï¼‰
echo >> ~/.bashrc
echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv bash)"' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯
brew --version
```

> ğŸ’¡ å›½å†…è®¿é—® GitHub éœ€è¦ä»£ç†ï¼Œç¡®ä¿ Clash è¿è¡Œä¸­ï¼ˆç«¯å£ 7890ï¼‰

### å®‰è£… Oh My Zsh

```bash
# ä»¥ momojie ç”¨æˆ·ç™»å½•
su - momojie

# å®‰è£… zshï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo apt-get install -y zsh

# å®‰è£… Oh My Zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

# å¦‚æœéœ€è¦ä»£ç†
proxy_on
```

### é…ç½®ä»£ç†åˆ«å

åœ¨ `~/.zshrc` æœ«å°¾æ·»åŠ ï¼š

```bash
# Proxy settings
alias proxy_on='export http_proxy=http://127.0.0.1:7890 https_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890 HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 ALL_PROXY=socks5://127.0.0.1:7890'
alias proxy_off='unset http_proxy https_proxy all_proxy HTTP_PROXY HTTPS_PROXY ALL_PROXY'

# Function to check proxy status
proxy_status() {
    if [ -n "$http_proxy" ]; then
        echo "Proxy is ON: $http_proxy"
    else
        echo "Proxy is OFF"
    fi
}
```

ä½¿ç”¨æ–¹å¼ï¼š
- `proxy_on` - å¼€å¯ä»£ç†
- `proxy_off` - å…³é—­ä»£ç†
- `proxy_status` - æŸ¥çœ‹ä»£ç†çŠ¶æ€

---

## ç›®å½•ç»“æ„

```
/root/env/
â”œâ”€â”€ docker/              # Docker å®¹å™¨æœåŠ¡
â”‚   â”œâ”€â”€ clash-conf/      # Clash ä»£ç†é…ç½®
â”‚   â”œâ”€â”€ frps/            # FRP å†…ç½‘ç©¿é€é…ç½®
â”‚   â”œâ”€â”€ mysql-conf/      # MySQL é…ç½®
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ log/                 # æ—¥å¿—ç›®å½•
â”‚   â””â”€â”€ iops_monitor/    # IOPS ç›‘æ§æ—¥å¿—
â”œâ”€â”€ iops_monitor.sh      # ç£ç›˜ IOPS ç›‘æ§è„šæœ¬
â””â”€â”€ .claude/             # Claude AI é…ç½®
```

---

## Docker æœåŠ¡

ä½ç½®ï¼š`/root/env/docker/`

### docker-compose.yml

```yaml
services:
  mysql:
    image: mysql:8.0
    container_name: mysql-dev
    environment:
      MYSQL_ROOT_PASSWORD: LoveYebao0924.
      MYSQL_DATABASE: devdb
      MYSQL_USER: devuser
      MYSQL_PASSWORD: LoveYebao0924.
    ports:
      - "21001:3306"
    volumes:
      # ä½¿ç”¨é¢å¤–çš„ç£ç›˜ç©ºé—´æ¥å­˜å‚¨ MySQL æ•°æ®
      - /mnt/mysql-data:/var/lib/mysql
      # å¯é€‰ï¼šæŒ‚è½½é…ç½®æ–‡ä»¶
      - ./mysql-conf:/etc/mysql/conf.d:ro
    restart: unless-stopped
    networks:
      - dev-network

  frps:
    image: stilleshan/frps:latest
    container_name: frps
    restart: unless-stopped
    ports:
      - "22001:22001"  # frp æœåŠ¡ç«¯å£
      - "22002:22002"  # SSH æ˜ å°„ç«¯å£ï¼ˆå¯æŒ‰éœ€æ·»åŠ æ›´å¤šç«¯å£ï¼‰
    volumes:
      - ./frps/frps.ini:/frp/frps.ini:ro
    networks:
      - dev-network

  clash:
    image: dreamacro/clash
    container_name: clash
    network_mode: "host"  # å…±äº«ä¸»æœºç½‘ç»œæ ˆ
    restart: unless-stopped
    volumes:
      - ./clash-conf/config.yml:/root/.config/clash/config.yaml:ro

networks:
  dev-network:
    driver: bridge
```

### æœåŠ¡åˆ—è¡¨

| æœåŠ¡ | å®¹å™¨å | ç«¯å£ | ç”¨é€” |
|------|--------|------|------|
| MySQL | mysql-dev | 21001:3306 | å¼€å‘æ•°æ®åº“ |
| FRPS | frps | 22001, 22002 | å†…ç½‘ç©¿é€æœåŠ¡ç«¯ |
| Clash | clash | host æ¨¡å¼ | ä»£ç†æœåŠ¡ |

### MySQL

- **é•œåƒ**: `mysql:8.0`
- **ç«¯å£**: 21001ï¼ˆå¤–éƒ¨ï¼‰â†’ 3306ï¼ˆå†…éƒ¨ï¼‰
- **æ•°æ®ç›®å½•**: `/mnt/mysql-data`
- **é…ç½®ç›®å½•**: `./mysql-conf/`
- **é»˜è®¤æ•°æ®åº“**: devdb

#### MySQL é…ç½® (my.cnf)

```ini
[mysqld]
# è®¾ç½®å­—ç¬¦é›†
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# è®¾ç½®æ—¶åŒº
default-time-zone = '+8:00'

# æ€§èƒ½ç›¸å…³é…ç½®
innodb_buffer_pool_size = 256M
innodb_log_file_size = 64M
max_connections = 200

# å®‰å…¨è®¾ç½®
sql_mode = STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO
```

### FRPS

- **é•œåƒ**: `stilleshan/frps:latest`
- **é…ç½®æ–‡ä»¶**: `./frps/frps.ini`
- **æœåŠ¡ç«¯å£**: 22001
- **SSH æ˜ å°„ç«¯å£**: 22002

#### FRPS é…ç½® (frps.ini)

```ini
[common]
# frp æœåŠ¡ç«¯å£
bind_port = 22001

# è®¤è¯ä»¤ç‰Œ
authentication_method = token
token = LoveYebao0924.

# å¿ƒè·³è¶…æ—¶ï¼ˆç§’ï¼‰- åº”å¤§äºå®¢æˆ·ç«¯çš„ heartbeat_timeoutï¼ˆ90ç§’ï¼‰
heartbeat_timeout = 120

# TCP å¤šè·¯å¤ç”¨ - å¼€å¯å¯å‡å°‘è¿æ¥æ•°ï¼Œæé«˜æ€§èƒ½
tcp_mux = true

# æ¯ä¸ªä»£ç†çš„æœ€å¤§è¿æ¥æ± å¤§å°
max_pool_count = 10

# å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶ï¼ˆç§’ï¼‰
user_conn_timeout = 10

# æ—¥å¿—é…ç½®
log_file = /dev/stdout
log_level = info
log_max_days = 3
```

### Clash

- **é•œåƒ**: `dreamacro/clash`
- **ç½‘ç»œæ¨¡å¼**: hostï¼ˆå…±äº«ä¸»æœºç½‘ç»œæ ˆï¼‰
- **é…ç½®æ–‡ä»¶**: `./clash-conf/config.yml`

> Clash é…ç½®æ–‡ä»¶è¾ƒå¤§ï¼ŒåŒ…å«ä»£ç†èŠ‚ç‚¹ä¿¡æ¯ï¼Œç›´æ¥æŸ¥çœ‹æºæ–‡ä»¶ï¼š`/root/env/docker/clash-conf/config.yml`

### å¸¸ç”¨å‘½ä»¤

```bash
# è¿›å…¥ç›®å½•
cd /root/env/docker

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f mysql

# é‡å¯æœåŠ¡
docker compose restart <æœåŠ¡å>
```

---

## IOPS ç›‘æ§è„šæœ¬

ä½ç½®ï¼š`/root/env/iops_monitor.sh`

### åŠŸèƒ½

- å®æ—¶ç›‘æ§ç£ç›˜ IOPS
- å½“ IOPS è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤ 1000ï¼‰æ—¶è‡ªåŠ¨è®°å½•ç³»ç»ŸçŠ¶æ€
- è®°å½•é«˜ IO è¿›ç¨‹ã€ç³»ç»Ÿè´Ÿè½½ã€å†…å­˜ä½¿ç”¨ç­‰ä¿¡æ¯

### é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| SAMPLE_INTERVAL | 2s | é‡‡æ ·é—´éš” |
| SPIKE_THRESHOLD | 1000 | IOPS é£™å‡é˜ˆå€¼ |
| SPIKE_COUNT | 3 | è¿ç»­è§¦å‘æ¬¡æ•° |
| CALM_WINDOW | 30s | è§¦å‘åå†·é™æœŸ |

### æ—¥å¿—ä½ç½®

- ä¸»æ—¥å¿—ï¼š`/root/env/log/iops_monitor/iops_spike.log`
- è¯¦ç»†æ—¥å¿—ï¼š`/root/env/log/iops_monitor/spike_*.log`

### è¿è¡Œ

```bash
# å‰å°è¿è¡Œ
/root/env/iops_monitor.sh

# åå°è¿è¡Œ
nohup /root/env/iops_monitor.sh > /dev/null 2>&1 &
```

---

## ç›¸å…³é“¾æ¥

- [[OpenClaw éƒ¨ç½²]] - OpenClaw æœåŠ¡éƒ¨ç½²ç¬”è®°
