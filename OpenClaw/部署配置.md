# OpenClaw 部署配置

OpenClaw 服务部署和迁移。

## 必须配置

> ⚠️ 这些配置是 OpenClaw 正常运行的必要设置，迁移后必须检查。

### Session DM Scope

**配置位置**: `~/.openclaw/openclaw.json`

```json
"session": {
  "dmScope": "per-peer"
}
```

**说明**:
- `per-peer`: 每个用户共享一个 DM session（推荐，跨频道记忆）
- `per-channel-peer`: 每个频道 + 用户独立 session（默认值）

**必须改为 `per-peer`**，否则在不同频道与同一用户对话时无法共享上下文。

## 安装（pnpm 方式）

前置条件：已安装 Node.js 22+ 和 pnpm

```bash
# 安装 OpenClaw
pnpm add -g openclaw@latest

# 批准构建脚本（pnpm 需要）
pnpm approve-builds -g
# 选择 openclaw, node-llama-cpp, sharp 等包

# 运行 onboarding
openclaw onboard --install-daemon
```

## 常用命令

```bash
# 查看服务状态
openclaw status

# Gateway 管理
openclaw gateway start
openclaw gateway stop
openclaw gateway restart

# 查看日志
openclaw logs

# 更新 OpenClaw
pnpm add -g openclaw@latest
```

## 迁移步骤

从旧系统迁移 OpenClaw 到新服务器的完整流程。

### 1. 旧系统：推送 workspace 和笔记

确保所有本地更改已推送到远程仓库：

```bash
# Workspace 目录
cd ~/.openclaw/workspace
git add -A
git commit -m "chore: sync before migration"
git push

# Obsidian 笔记（如果在单独仓库）
cd ~/.openclaw/workspace/obsidian/aliyun-ops
git add -A
git commit -m "chore: sync notes before migration"
git push
```

### 2. 新系统：安装 OpenClaw

```bash
pnpm add -g openclaw@latest
pnpm approve-builds -g
openclaw onboard --install-daemon
```

### 3. 克隆 workspace

```bash
# 克隆到默认 workspace 目录
cd ~/.openclaw
git clone <你的 workspace 仓库地址> workspace

# 如果笔记是独立仓库
cd ~/.openclaw/workspace/obsidian
git clone <笔记仓库地址> aliyun-ops
```

### 4. 完成 Onboard

```bash
# 检查状态
openclaw doctor     # 检查配置
openclaw status     # 查看服务状态

# 启动 Gateway
openclaw gateway start

# 打开 Dashboard
openclaw dashboard
```

## 相关

- [[WeCom配置]] - 企业微信通道配置
